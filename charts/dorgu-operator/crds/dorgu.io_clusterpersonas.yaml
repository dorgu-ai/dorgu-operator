---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: clusterpersonas.dorgu.io
spec:
  group: dorgu.io
  names:
    kind: ClusterPersona
    listKind: ClusterPersonaList
    plural: clusterpersonas
    singular: clusterpersona
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.environment
      name: Environment
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.resourceSummary.totalPods
      name: Nodes
      type: integer
    - jsonPath: .status.applicationCount
      name: Apps
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: |-
          ClusterPersona is the Schema for the clusterpersonas API.
          It represents the identity and configuration of a Kubernetes cluster.
          ClusterPersona is cluster-scoped (singleton per cluster).
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of ClusterPersona.
            properties:
              conventions:
                description: conventions defines naming and labeling standards.
                properties:
                  namespacePrefix:
                    description: namespacePrefix defines the prefix for namespace
                      names.
                    type: string
                  namingPattern:
                    description: namingPattern defines the pattern for resource names.
                    type: string
                  requiredAnnotations:
                    description: requiredAnnotations lists annotations that must be
                      present.
                    items:
                      type: string
                    type: array
                  requiredLabels:
                    description: requiredLabels lists labels that must be present
                      on all resources.
                    items:
                      type: string
                    type: array
                type: object
              defaults:
                description: defaults defines default values for applications in this
                  cluster.
                properties:
                  namespace:
                    description: namespace is the default namespace for new applications.
                    type: string
                  registry:
                    description: registry is the default container registry.
                    type: string
                  resources:
                    description: resources defines default resource requests/limits.
                    properties:
                      limits:
                        description: ResourceValues holds CPU and memory strings.
                        properties:
                          cpu:
                            type: string
                          memory:
                            type: string
                        type: object
                      profile:
                        description: profile is a named resource profile.
                        enum:
                        - minimal
                        - standard
                        - compute-heavy
                        - memory-heavy
                        type: string
                      requests:
                        description: ResourceValues holds CPU and memory strings.
                        properties:
                          cpu:
                            type: string
                          memory:
                            type: string
                        type: object
                    type: object
                  scaling:
                    description: scaling defines default scaling parameters.
                    properties:
                      behavior:
                        default: balanced
                        enum:
                        - conservative
                        - balanced
                        - aggressive
                        type: string
                      maxReplicas:
                        format: int32
                        minimum: 1
                        type: integer
                      minReplicas:
                        format: int32
                        minimum: 0
                        type: integer
                      targetCPU:
                        format: int32
                        maximum: 100
                        minimum: 1
                        type: integer
                      targetMemory:
                        format: int32
                        maximum: 100
                        minimum: 1
                        type: integer
                    type: object
                type: object
              description:
                description: description provides context about this cluster.
                type: string
              environment:
                default: development
                description: environment indicates the cluster's purpose.
                enum:
                - development
                - staging
                - production
                - sandbox
                type: string
              name:
                description: name is the cluster's friendly name.
                type: string
              policies:
                description: policies defines cluster-wide security and governance
                  rules.
                properties:
                  compliance:
                    description: compliance lists compliance frameworks this cluster
                      adheres to.
                    items:
                      type: string
                    type: array
                  networking:
                    description: networking defines network policies.
                    properties:
                      allowedExternalCIDRs:
                        description: allowedExternalCIDRs lists allowed external IP
                          ranges.
                        items:
                          type: string
                        type: array
                      defaultDenyEgress:
                        default: false
                        description: defaultDenyEgress enables default deny for egress
                          traffic.
                        type: boolean
                      defaultDenyIngress:
                        default: false
                        description: defaultDenyIngress enables default deny for ingress
                          traffic.
                        type: boolean
                    type: object
                  security:
                    description: security defines security constraints for all workloads.
                    properties:
                      allowedRegistries:
                        description: allowedRegistries limits which container registries
                          can be used.
                        items:
                          type: string
                        type: array
                      disallowPrivileged:
                        default: true
                        description: disallowPrivileged prevents privileged containers.
                        type: boolean
                      enforceNonRoot:
                        default: true
                        description: enforceNonRoot requires all containers to run
                          as non-root.
                        type: boolean
                      enforceReadOnlyRoot:
                        default: false
                        description: enforceReadOnlyRoot requires read-only root filesystems.
                        type: boolean
                      podSecurityStandard:
                        default: baseline
                        description: podSecurityStandard sets the Pod Security Standard
                          level.
                        enum:
                        - privileged
                        - baseline
                        - restricted
                        type: string
                    type: object
                type: object
              resourceQuotas:
                description: resourceQuotas defines cluster-wide resource constraints.
                properties:
                  maxCPUPerNamespace:
                    description: maxCPUPerNamespace limits total CPU per namespace.
                    type: string
                  maxMemoryPerNamespace:
                    description: maxMemoryPerNamespace limits total memory per namespace.
                    type: string
                  maxPVCsPerNamespace:
                    description: maxPVCsPerNamespace limits PVCs per namespace.
                    format: int32
                    type: integer
                  maxPodsPerNamespace:
                    description: maxPodsPerNamespace limits pods per namespace.
                    format: int32
                    type: integer
                type: object
            required:
            - name
            type: object
          status:
            description: status defines the observed state of ClusterPersona.
            properties:
              addons:
                description: addons lists discovered cluster add-ons.
                items:
                  description: AddonInfo contains information about a cluster add-on.
                  properties:
                    healthy:
                      description: healthy indicates if the add-on is healthy.
                      type: boolean
                    installed:
                      description: installed indicates if the add-on is detected.
                      type: boolean
                    name:
                      description: name is the add-on name.
                      type: string
                    namespace:
                      description: namespace is where the add-on is installed.
                      type: string
                    type:
                      description: type categorizes the add-on.
                      enum:
                      - gitops
                      - monitoring
                      - logging
                      - ingress
                      - service-mesh
                      - secrets
                      - cert-management
                      - other
                      type: string
                    version:
                      description: version is the detected version.
                      type: string
                  required:
                  - installed
                  - name
                  type: object
                type: array
              applicationCount:
                description: applicationCount is the number of ApplicationPersonas
                  in the cluster.
                format: int32
                type: integer
              conditions:
                description: conditions follow the standard Kubernetes condition pattern.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              kubernetesVersion:
                description: kubernetesVersion is the cluster's Kubernetes version.
                type: string
              lastDiscovery:
                description: lastDiscovery records when the operator last discovered
                  cluster state.
                format: date-time
                type: string
              namespaces:
                description: namespaces contains namespace information.
                properties:
                  active:
                    description: active is the number of active namespaces.
                    format: int32
                    type: integer
                  total:
                    description: total is the total number of namespaces.
                    format: int32
                    type: integer
                  withPersonas:
                    description: withPersonas is the number of namespaces with ApplicationPersonas.
                    format: int32
                    type: integer
                required:
                - total
                type: object
              nodes:
                description: nodes contains information about cluster nodes.
                items:
                  description: NodeInfo contains information about a cluster node.
                  properties:
                    allocatable:
                      description: allocatable contains the node's allocatable resources.
                      properties:
                        cpu:
                          description: cpu is the CPU capacity/allocatable.
                          type: string
                        ephemeralStorage:
                          description: ephemeralStorage is the ephemeral storage capacity.
                          type: string
                        memory:
                          description: memory is the memory capacity/allocatable.
                          type: string
                        pods:
                          description: pods is the pod capacity/allocatable.
                          type: string
                      type: object
                    capacity:
                      description: capacity contains the node's resource capacity.
                      properties:
                        cpu:
                          description: cpu is the CPU capacity/allocatable.
                          type: string
                        ephemeralStorage:
                          description: ephemeralStorage is the ephemeral storage capacity.
                          type: string
                        memory:
                          description: memory is the memory capacity/allocatable.
                          type: string
                        pods:
                          description: pods is the pod capacity/allocatable.
                          type: string
                      type: object
                    containerRuntime:
                      description: containerRuntime is the node's container runtime.
                      type: string
                    kubeletVersion:
                      description: kubeletVersion is the node's kubelet version.
                      type: string
                    labels:
                      additionalProperties:
                        type: string
                      description: labels contains key node labels.
                      type: object
                    name:
                      description: name is the node name.
                      type: string
                    ready:
                      description: ready indicates if the node is ready.
                      type: boolean
                    role:
                      description: role indicates the node role (control-plane, worker).
                      type: string
                    taints:
                      description: taints lists the node's taints.
                      items:
                        type: string
                      type: array
                  required:
                  - name
                  - ready
                  type: object
                type: array
              phase:
                description: phase summarizes the overall cluster state.
                enum:
                - Discovering
                - Ready
                - Degraded
                - Unknown
                type: string
              platform:
                description: platform identifies the cluster platform (EKS, GKE, AKS,
                  etc.).
                type: string
              resourceSummary:
                description: resourceSummary contains cluster-wide resource usage.
                properties:
                  allocatableCPU:
                    description: allocatableCPU is the total allocatable CPU.
                    type: string
                  allocatableMemory:
                    description: allocatableMemory is the total allocatable memory.
                    type: string
                  cpuUtilization:
                    description: cpuUtilization is the CPU utilization percentage.
                    type: string
                  memoryUtilization:
                    description: memoryUtilization is the memory utilization percentage.
                    type: string
                  runningPods:
                    description: runningPods is the number of running pods.
                    format: int32
                    type: integer
                  totalCPU:
                    description: totalCPU is the total CPU capacity across all nodes.
                    type: string
                  totalMemory:
                    description: totalMemory is the total memory capacity across all
                      nodes.
                    type: string
                  totalPods:
                    description: totalPods is the total pod capacity.
                    format: int32
                    type: integer
                  usedCPU:
                    description: usedCPU is the currently used CPU (from metrics).
                    type: string
                  usedMemory:
                    description: usedMemory is the currently used memory (from metrics).
                    type: string
                type: object
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
